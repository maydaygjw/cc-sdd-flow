# Audio Recorder - 规格说明书

> 回答"做什么"（What）和"为什么"（Why），而非"怎么做"（How）

---

## 1. 概述

### 1.1 背景与目标

用户需要将 Spotify 播客节目录制为本地 MP3 文件，以便离线收听或存档。现有方案需要手动操作浏览器并配合第三方录音软件，流程繁琐且无法自动化。

本工具提供一个 CLI 命令，用户传入 Spotify episode URL 后，工具自动完成浏览器启动、登录验证、播放触发、音频录制、文件输出全流程，无需人工干预（已登录状态下）。

### 1.2 系统边界

**外部依赖**:
- **Spotify Web Player**：通过浏览器访问，提供音频播放和播放进度信息

**系统职责**:
- 启动浏览器并导航到目标 URL
- 检测 Spotify 登录状态，未登录时提供辅助登录手段
- 触发播放并录制音频
- 自动检测播放结束
- 将录制内容编码为 MP3 并保存

---

## 2. 核心业务流程

### 2.1 主录制流程

1. 用户执行命令，传入 Spotify episode URL 和可选输出路径
2. 系统启动浏览器并导航到目标 URL
3. 系统检测 Spotify 登录状态
4. 若已登录，跳至步骤 6
5. 若未登录，执行登录流程（见 2.2）
6. 系统触发播放并开始录制音频
7. 系统监控播放进度
8. 检测到播放结束，系统停止录制
9. 系统将录制内容编码为 MP3，保存到指定路径
10. 系统输出成功信息（文件路径、时长）并退出
11. **异常**：URL 无效或 episode 不存在 → 输出错误信息并退出，不创建文件

### 2.2 登录流程

1. 系统检测到 Spotify 未登录状态
2. 系统启动图形辅助界面，输出连接信息
3. 系统提示用户通过该界面完成 Spotify 登录
4. 系统轮询登录状态
5. 检测到登录成功，系统关闭图形辅助界面，继续主录制流程
6. **异常**：等待超时（默认 10 分钟）→ 输出超时错误并退出


## 3. 功能范围

**支持**:
- Spotify Web Player episode URL（格式：`https://open.spotify.com/episode/{id}`）
- 持久化登录状态（跨工具重启保持）
- 图形界面辅助登录
- 自动检测播放结束
- Ctrl+C 中断并保存已录制内容
- 自定义输出文件路径

**不支持**:
- Spotify 播放列表或专辑批量录制
- Apple Podcast 等其他平台（当前版本）
- 音频后处理（降噪、音量标准化等）
- 无头模式（需要图形界面用于辅助登录）

---

## 4. 非功能需求

- 输出 MP3 编码质量：192kbps，44.1kHz，立体声
- 登录等待超时：默认 10 分钟，可通过参数配置
- 播放结束检测精度：误差不超过 2 秒
- 登录状态持久化路径可通过参数指定，默认使用固定路径

---

## 5. 验收标准

- [ ] 传入有效 episode URL，已登录状态下，工具自动完成录制并输出 MP3 文件
- [ ] 输出 MP3 文件时长与 Spotify 显示的 episode 时长误差不超过 5 秒
- [ ] 未登录状态下，工具启动图形辅助界面并输出连接信息，等待用户登录后自动继续
- [ ] 登录成功后，图形辅助界面自动关闭
- [ ] 登录等待超过超时时间，工具输出错误信息并退出，不留残留进程
- [ ] Ctrl+C 中断后，已录制内容保存为 MP3，不丢失
- [ ] 传入无效 URL，工具输出明确错误信息并退出，不创建空文件
- [ ] 登录状态在工具重启后保持有效
- [ ] 输出文件出现在用户指定的宿主机目录

---

## 6. 假设与约束

- 工具以容器化方式分发，支持跨平台运行
- 无需宿主机物理音频设备
- 浏览器环境内置于工具分发包中，无需用户单独安装
- Spotify 免费账户可能有广告插播，录制内容包含广告音频（不做过滤）
- 播放器控制模块设计为可替换接口，以便后续接入其他播客平台

---

## 7. 术语表

- **episode URL**：Spotify 单集播客的网页链接，格式为 `https://open.spotify.com/episode/{id}`
- **持久化登录状态**：用户登录凭证在工具关闭后仍然保存，下次启动无需重新登录
- **图形辅助界面**：为用户提供可视化浏览器操作界面的机制，用于手动完成登录
