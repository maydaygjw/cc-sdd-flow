---
name: generate_plan
description: 根据给定的规格说明模块生成详细的技术实现方案（计划），包括架构设计、技术选型、API设计、数据库设计等
parameters:
  - name: module
    description: 规格说明模块目录名称（例如：001-core-functionality）
    required: true
inputs:
  - specs/{module}/spec.md
  - constitution.md
  - .claude/templates/plan-template.md
outputs:
  - specs/{module}/plan.md
---

## 角色

你是一位**首席架构师和技术方案设计师**，负责将业务需求转化为详细的技术实现方案。请根据spec.md中的业务需求生成plan.md，技术方案必须基于业务需求，不得添加规格说明中未提及的功能（严格按照规格说明设计，不要给自己加戏！）

---

## 任务

给定模块 `{module}`，读取并充分理解：

- `./specs/{module}/spec.md`
- `./constitution.md`
- `./.claude/templates/plan-template.md`（技术方案模板）

将 `spec.md` 中描述的业务需求转换为**详细的技术实现方案**，包括但不限于架构设计、技术选型、API设计、数据库设计等。

---

## 硬性约束

### 1. 方案完整性

- 技术方案必须涵盖架构设计、技术选型、API设计、数据库设计等方面。
- 不允许缺失关键设计要素。
- 不允许模糊的设计描述，例如"实现所有功能"。

技术方案必须是全面的、可执行的，并且可以直接指导开发团队实施。

---

### 2. 架构设计原则

- 必须遵循单一职责原则。
- 遵循分层架构模式：`接口层 → 业务层 → 数据层`
- 考虑系统的可扩展性和可维护性

---

### 3. 方案组织结构

**必须严格遵循 plan-template.md 中的结构**：

- **架构概述**：系统整体架构设计和模块划分
- **技术选型**：编程语言、框架、数据库、中间件等技术栈选择
- **API设计**：RESTful API设计规范和具体接口定义
- **数据库设计**：表结构设计、索引策略、关系设计
- **安全设计**：身份认证、授权、数据保护等安全措施
- **性能设计**：缓存策略、并发处理、性能优化方案
- **部署架构**：部署方案、环境配置、容器化设计
- **监控与日志**：系统监控、日志记录、告警机制

---

### 4. 输出格式要求

**完全参照 plan-template.md 的格式**，包括但不限于：

1. **技术方案概述**部分：说明设计方案的基本原则
2. **系统架构设计**：整体架构图、模块划分、技术栈选择
3. **接口层设计**：API路由、请求响应格式、错误处理规范
4. **业务层设计**：服务层划分、业务逻辑流程、异常处理
5. **数据层设计**：数据库表结构、实体关系图、索引策略
6. **安全设计**：认证授权机制、数据加密、防护措施
7. **性能优化**：缓存策略、并发处理、负载均衡方案
8. **部署方案**：环境配置、容器化、CI/CD流程
9. **测试策略**：单元测试、集成测试、端到端测试方案
10. **方案总结**：设计亮点、风险评估、实施建议

---

### 5. 方案命名规范

每个设计方案必须：
- 有清晰的章节编号（1, 2, 3...）
- 包含具体的技术选型说明
- 使用**粗体**标题
- 包含详细的技术实现说明
- 明确各模块职责和交互关系

---

## 输出示例

参考 `.claude/templates/plan-template.md` 中的完整结构，确保生成的技术方案：

1. 结构完整，包含所有必要章节
2. 技术选型符合项目开发宪法要求
3. API设计遵循RESTful规范
4. 数据库设计满足业务需求
5. 安全设计覆盖常见安全威胁
6. 性能设计考虑系统性能要求
7. 部署方案可操作性强

---

## 执行流程

1. 读取并理解 `spec.md` 中的业务需求和功能描述
2. 读取并理解 `constitution.md` 中的开发原则和技术标准
3. 参考 `plan-template.md` 的结构和格式
4. 分析业务需求确定系统架构和模块划分
5. 根据技术标准选择合适的技术栈
6. 设计API接口规范和数据交互格式
7. 设计数据库表结构和关系模型
8. 规划安全机制和防护措施
9. 制定性能优化和缓存策略
10. 设计部署架构和运维方案
11. 制定测试策略和质量保证方案
12. 生成方案总结和实施建议

---

## 质量检查清单

生成技术方案后，确认：

- [ ] 方案涵盖了所有必要的技术设计章节
- [ ] 技术选型符合项目开发宪法要求
- [ ] API设计遵循RESTful规范
- [ ] 数据库设计满足业务需求
- [ ] 安全设计覆盖常见安全威胁
- [ ] 性能设计考虑系统性能要求
- [ ] 部署方案具有可操作性
- [ ] 测试策略覆盖各种测试场景
- [ ] 方案结构符合 plan-template.md 标准
- [ ] 设计方案可行且可实施
- [ ] 风险评估和应对措施到位